{
	"name": "Server",
	"events": [
		{
			"eventType": "variable",
			"name": "NGIO_sessionID",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 547081615323362
		},
		{
			"eventType": "comment",
			"text": "User flags"
		},
		{
			"eventType": "variable",
			"name": "SERVER_isLoggedIn",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 388010277247496
		},
		{
			"eventType": "variable",
			"name": "SERVER_isAdmin",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 704377609683245
		},
		{
			"eventType": "comment",
			"text": "Uploaded character"
		},
		{
			"eventType": "variable",
			"name": "SERVER_hasUploadedCharacter",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 677206397739236
		},
		{
			"eventType": "variable",
			"name": "SERVER_uploadedCharacterData",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 458958480398819
		},
		{
			"eventType": "variable",
			"name": "SERVER_uploadedCharacterID",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 101941177206993
		},
		{
			"eventType": "variable",
			"name": "SERVER_uploadedCharacterEditable",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 935897483201686
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Server - Login",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"functionName": "authStateChange",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "state",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 840133438119362
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 266556607796293,
					"children": [
						{
							"eventType": "comment",
							"text": "We've logged in"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 691230827600092,
									"parameters": {
										"variable": "state",
										"comparison": 0,
										"value": "\"true\""
									}
								}
							],
							"actions": [],
							"sid": 247988440628902,
							"children": [
								{
									"eventType": "comment",
									"text": "If we're already logged in, do nothing"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 148771453795772,
											"parameters": {
												"variable": "SERVER_isLoggedIn"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"id": "set-boolean-eventvar",
											"objectClass": "System",
											"sid": 719473776047887,
											"parameters": {
												"variable": "SERVER_isLoggedIn",
												"value": "true"
											}
										},
										{
											"type": "comment",
											"text": "Sets our admin state on client... no, the server doesn't let you use this unrestricted"
										},
										{
											"type": "script",
											"language": "typescript",
											"script": [
												"runtime.globalVars.SERVER_isAdmin = await validateAdminAccess();"
											]
										}
									],
									"sid": 948656096756478,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 331476146071867,
													"parameters": {
														"variable": "MENU_overlayMenu",
														"comparison": 0,
														"value": "\"Login\""
													}
												}
											],
											"actions": [
												{
													"callFunction": "switchOverlayMenu",
													"sid": 291513167037150,
													"parameters": [
														"\"\""
													]
												}
											],
											"sid": 942213637915426
										},
										{
											"eventType": "comment",
											"text": "Store our uploaded character locally"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 505924995365713,
													"parameters": {
														"variable": "SERVER_uploadedCharacterData",
														"comparison": 0,
														"value": "\"\""
													}
												}
											],
											"actions": [
												{
													"callFunction": "getUploadedCharacter",
													"sid": 329405157289081
												}
											],
											"sid": 475923620353439
										}
									]
								}
							]
						},
						{
							"eventType": "comment",
							"text": "We've logged out"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 678924766805001
								}
							],
							"actions": [
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 799111098543884,
									"parameters": {
										"variable": "SERVER_isLoggedIn",
										"value": "false"
									}
								},
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 957596164899883,
									"parameters": {
										"variable": "SERVER_isAdmin",
										"value": "false"
									}
								},
								{
									"callFunction": "setUploadedCharacter",
									"sid": 291745200090342,
									"parameters": [
										"\"\"",
										"\"\"",
										false
									]
								}
							],
							"sid": 207165158508499
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "signal",
									"objectClass": "System",
									"sid": 668659375413448,
									"parameters": {
										"tag": "\"updateLoginButton\""
									}
								}
							],
							"sid": 975483828705115
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Handle uploaded character"
				},
				{
					"functionName": "getUploadedCharacter",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [],
					"eventType": "function-block",
					"conditions": [],
					"actions": [
						{
							"type": "script",
							"language": "typescript",
							"script": [
								"runtime.globalVars.SERVER_uploadedCharacterData = \"waiting\";",
								"",
								"getUserCharacter().then(result => {",
								"  if (result.data) {",
								"    runtime.callFunction(\"setUploadedCharacter\", JSON.stringify(result.data), result.data.id, +result.data.can_edit);",
								"  } else {",
								"    runtime.callFunction(\"setUploadedCharacter\", \"\", \"\", \"\");",
								"  }",
								"});"
							]
						}
					],
					"sid": 181584207207859
				},
				{
					"functionName": "setUploadedCharacter",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "data",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 659804526494516
						},
						{
							"name": "id",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 188831352013955
						},
						{
							"name": "editable",
							"type": "boolean",
							"initialValue": "false",
							"comment": "",
							"sid": 943012892838615
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 388360843986296,
							"parameters": {
								"variable": "SERVER_uploadedCharacterData",
								"value": "data"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 437843345498196,
							"parameters": {
								"variable": "SERVER_uploadedCharacterID",
								"value": "id"
							}
						},
						{
							"id": "set-boolean-eventvar",
							"objectClass": "System",
							"sid": 840792797002319,
							"parameters": {
								"variable": "SERVER_uploadedCharacterEditable",
								"value": "false"
							}
						}
					],
					"sid": 685959560752740,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 194828193708599,
									"parameters": {
										"variable": "data",
										"comparison": 1,
										"value": "\"\""
									}
								}
							],
							"actions": [
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 222787965194449,
									"parameters": {
										"variable": "SERVER_hasUploadedCharacter",
										"value": "true"
									}
								}
							],
							"sid": 693850425113181,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 697605872450481,
											"parameters": {
												"variable": "editable"
											}
										}
									],
									"actions": [
										{
											"id": "set-boolean-eventvar",
											"objectClass": "System",
											"sid": 497570013011271,
											"parameters": {
												"variable": "SERVER_uploadedCharacterEditable",
												"value": "true"
											}
										}
									],
									"sid": 431120412997037
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 402025413648299
								}
							],
							"actions": [
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 252218861658592,
									"parameters": {
										"variable": "SERVER_hasUploadedCharacter",
										"value": "false"
									}
								}
							],
							"sid": 731617887007578
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 934329744152645,
									"parameters": {
										"first-value": "LayoutName",
										"comparison": 0,
										"second-value": "\"Plaza\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "updateCharacterList",
									"sid": 689117586683297,
									"parameters": [
										"PLAZA_state"
									]
								}
							],
							"sid": 985130282677069
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 370974304441256,
									"parameters": {
										"first-value": "LayoutName",
										"comparison": 0,
										"second-value": "\"Creator\""
									}
								},
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 749364505013538,
									"parameters": {
										"variable": "MENU_menu",
										"comparison": 0,
										"value": "\"Card\""
									}
								}
							],
							"actions": [
								{
									"id": "signal",
									"objectClass": "System",
									"sid": 150586458002656,
									"parameters": {
										"tag": "\"updateCardButtons\""
									}
								}
							],
							"sid": 932175988213318
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Update the login button state"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-start-of-layout",
							"objectClass": "System",
							"sid": 361408795116389
						},
						{
							"id": "on-signal",
							"objectClass": "System",
							"sid": 316994684053531,
							"parameters": {
								"tag": "\"updateLoginButton\""
							}
						}
					],
					"actions": [],
					"sid": 456209038244414,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "Button",
									"sid": 900188742246903,
									"parameters": {
										"instance-variable": "type",
										"comparison": 0,
										"value": "\"login\""
									}
								},
								{
									"id": "pick-children",
									"objectClass": "Button",
									"sid": 818818910509285,
									"parameters": {
										"child": "Text",
										"which": "own"
									}
								}
							],
							"actions": [],
							"sid": 575267640381985,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 827092152400432,
											"parameters": {
												"variable": "SERVER_isLoggedIn"
											}
										}
									],
									"actions": [
										{
											"id": "set-text",
											"objectClass": "Text",
											"sid": 929609722675541,
											"parameters": {
												"text": "\"Log out\""
											}
										}
									],
									"sid": 443273752613763,
									"children": [
										{
											"eventType": "comment",
											"text": "No need to log out on Newgrounds"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-boolean-eventvar",
													"objectClass": "System",
													"sid": 280177784996567,
													"parameters": {
														"variable": "NGIO_onNewgrounds"
													}
												}
											],
											"actions": [
												{
													"id": "set-boolean-instvar",
													"objectClass": "Button",
													"sid": 132492037354141,
													"parameters": {
														"instance-variable": "disabled",
														"value": "true"
													}
												}
											],
											"sid": 985374378800155
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 503312640692084
										}
									],
									"actions": [
										{
											"id": "set-text",
											"objectClass": "Text",
											"sid": 244755197266055,
											"parameters": {
												"text": "\"Log in\""
											}
										}
									],
									"sid": 335490184612231
								}
							]
						}
					],
					"isOrBlock": true
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Server - Login (Buttons)",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "comment",
							"text": "Login"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 669640061167880,
									"parameters": {
										"tag": "\"button_login\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 336014980063264,
									"parameters": {
										"audio-file": {
											"path": "select"
										},
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								}
							],
							"sid": 306826623881897,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 200409917968424,
											"parameters": {
												"variable": "NGIO_onNewgrounds"
											},
											"isInverted": true
										}
									],
									"actions": [],
									"sid": 635172860999341,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-boolean-eventvar",
													"objectClass": "System",
													"sid": 513446268483250,
													"parameters": {
														"variable": "SERVER_isLoggedIn"
													},
													"isInverted": true
												}
											],
											"actions": [],
											"sid": 919471860948733,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 446219092816470,
															"parameters": {
																"variable": "MENU_overlayMenu",
																"comparison": 1,
																"value": "\"Login\""
															}
														}
													],
													"actions": [
														{
															"callFunction": "switchOverlayMenu",
															"sid": 584904460718641,
															"parameters": [
																"\"Login\""
															]
														}
													],
													"sid": 832817980834739
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 507597546220434
														}
													],
													"actions": [
														{
															"callFunction": "switchOverlayMenu",
															"sid": 143857433018218,
															"parameters": [
																"\"\""
															]
														}
													],
													"sid": 124267350072250
												}
											]
										},
										{
											"eventType": "comment",
											"text": "Logout, flush uploaded character"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 226607011749184
												}
											],
											"actions": [
												{
													"type": "script",
													"language": "typescript",
													"script": [
														"logout();"
													]
												},
												{
													"id": "subtract-from-eventvar",
													"objectClass": "System",
													"sid": 366961302552657,
													"parameters": {
														"variable": "GAME_selectedCharacterIndex",
														"value": "1"
													}
												}
											],
											"sid": 228952056500873,
											"children": [
												{
													"eventType": "comment",
													"text": "Logout of Newgrounds"
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "is-logged-in",
															"objectClass": "NGIO",
															"sid": 151275174935589
														}
													],
													"actions": [
														{
															"id": "logout",
															"objectClass": "NGIO",
															"sid": 401730996359702
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 422802944195644,
															"parameters": {
																"variable": "NGIO_sessionID",
																"value": "\"\""
															}
														}
													],
													"sid": 812699842167364
												}
											]
										}
									]
								},
								{
									"eventType": "comment",
									"text": "Skip straight to a NG login"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 359272605953236
										}
									],
									"actions": [
										{
											"id": "login",
											"objectClass": "NGIO",
											"sid": 601440249576485,
											"parameters": {
												"window-mode": "popup"
											}
										}
									],
									"sid": 555726136961088
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 487515199730664,
									"parameters": {
										"tag": "\"buttonE_login\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 817000677723226,
									"parameters": {
										"audio-file": {
											"path": "error"
										},
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								}
							],
							"sid": 309479294241728
						},
						{
							"eventType": "comment",
							"text": "Login Google"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 332409300021249,
									"parameters": {
										"tag": "\"button_loginGoogle\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 636635527688334,
									"parameters": {
										"audio-file": {
											"path": "select"
										},
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"loginWithGoogle();"
									]
								}
							],
							"sid": 451050660063865
						},
						{
							"eventType": "comment",
							"text": "Login Itch"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 184771585005132,
									"parameters": {
										"tag": "\"button_loginItch\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 139609875815621,
									"parameters": {
										"audio-file": {
											"path": "select"
										},
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"loginWithItch();"
									]
								}
							],
							"sid": 128902473359258
						},
						{
							"eventType": "comment",
							"text": "Login Newgrounds"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 271924202656439,
									"parameters": {
										"tag": "\"button_loginNewgrounds\""
									}
								}
							],
							"actions": [],
							"sid": 895498652903983,
							"children": [
								{
									"eventType": "comment",
									"text": "TODO: Triggers twice"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-ready",
											"objectClass": "NGIO",
											"sid": 435265702355208
										}
									],
									"actions": [
										{
											"id": "play",
											"objectClass": "Audio",
											"sid": 242747818779535,
											"parameters": {
												"audio-file": {
													"path": "select"
												},
												"loop": "not-looping",
												"volume": "(log10(SETTING_volumeSound)*20)",
												"stereo-pan": "0",
												"tag-optional": "\"\""
											}
										},
										{
											"id": "login",
											"objectClass": "NGIO",
											"sid": 332317991084266,
											"parameters": {
												"window-mode": "popup"
											}
										}
									],
									"sid": 106978140348144
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 863165825861540
										}
									],
									"actions": [
										{
											"callFunction": "error",
											"sid": 454782679319075,
											"parameters": [
												"\"NGIO has not yet initialized. Server may be down.\""
											]
										}
									],
									"sid": 569750784770595
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-login-success",
									"objectClass": "NGIO",
									"sid": 750001847314600
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 683671985035179,
									"parameters": {
										"variable": "NGIO_sessionID",
										"value": "NGIO.SessionID"
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"const session_id = runtime.globalVars.NGIO_sessionID as string;",
										"authenticateNewgrounds(session_id);"
									]
								}
							],
							"sid": 774989036771965
						}
					],
					"sid": 498964445715037
				}
			],
			"sid": 807351581983461
		}
	],
	"sid": 604583817691514
}