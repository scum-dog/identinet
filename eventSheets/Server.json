{
	"name": "Server",
	"events": [
		{
			"eventType": "variable",
			"name": "NGIO_sessionID",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 547081615323362
		},
		{
			"eventType": "variable",
			"name": "SERVER_hasUploadedCharacter",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 677206397739236
		},
		{
			"eventType": "variable",
			"name": "SERVER_uploadedCharacterData",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 846000082272557
		},
		{
			"eventType": "variable",
			"name": "SERVER_loggedIn",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 927237439426498
		},
		{
			"eventType": "variable",
			"name": "SERVER_isAdmin",
			"type": "boolean",
			"initialValue": "false",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 694373196404082
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Server - Login",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"functionName": "authStateChange",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionCopyPicked": false,
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "state",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 840133438119362
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 266556607796293,
					"children": [
						{
							"eventType": "comment",
							"text": "We've logged in"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 691230827600092,
									"parameters": {
										"variable": "state",
										"comparison": 0,
										"value": "\"true\""
									}
								}
							],
							"actions": [],
							"sid": 247988440628902,
							"children": [
								{
									"eventType": "comment",
									"text": "If we're already logged in, do nothing"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 148771453795772,
											"parameters": {
												"variable": "SERVER_loggedIn"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"id": "set-boolean-eventvar",
											"objectClass": "System",
											"sid": 719473776047887,
											"parameters": {
												"variable": "SERVER_loggedIn",
												"value": "true"
											}
										},
										{
											"type": "comment",
											"text": "Sets our admin state on client... no, the server doesn't let you use this unrestricted"
										},
										{
											"type": "script",
											"language": "typescript",
											"script": [
												"runtime.globalVars.SERVER_isAdmin = await validateAdminAccess();"
											]
										}
									],
									"sid": 948656096756478,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 331476146071867,
													"parameters": {
														"variable": "MENU_overlayMenu",
														"comparison": 0,
														"value": "\"Login\""
													}
												}
											],
											"actions": [
												{
													"callFunction": "switchOverlayMenu",
													"sid": 291513167037150,
													"parameters": [
														"\"\""
													]
												}
											],
											"sid": 942213637915426
										},
										{
											"eventType": "comment",
											"text": "If our character exists, we should create it"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 505924995365713,
													"parameters": {
														"variable": "SERVER_uploadedCharacterData",
														"comparison": 0,
														"value": "\"\""
													}
												}
											],
											"actions": [
												{
													"type": "script",
													"language": "typescript",
													"script": [
														"runtime.globalVars.SERVER_uploadedCharacterData = \"waiting\";",
														"",
														"getUserCharacter().then(result => {",
														"  if (result.data) {",
														"    runtime.globalVars.SERVER_uploadedCharacterData = JSON.stringify(result.data);",
														"    runtime.signal(\"storeUploadedCharacter\");",
														"  } else {",
														"    runtime.globalVars.SERVER_uploadedCharacterData = \"\";",
														"  }",
														"});"
													]
												}
											],
											"sid": 475923620353439
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-two-values",
													"objectClass": "System",
													"sid": 440762588842680,
													"parameters": {
														"first-value": "LayoutName",
														"comparison": 0,
														"second-value": "\"Creator\""
													}
												},
												{
													"id": "compare-eventvar",
													"objectClass": "System",
													"sid": 463595580869592,
													"parameters": {
														"variable": "MENU_menu",
														"comparison": 0,
														"value": "\"Card\""
													}
												}
											],
											"actions": [
												{
													"callFunction": "switchCardButtons",
													"sid": 273716120004421,
													"parameters": [
														true
													]
												}
											],
											"sid": 309549913221223
										}
									]
								}
							]
						},
						{
							"eventType": "comment",
							"text": "We've logged out"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 678924766805001
								}
							],
							"actions": [
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 799111098543884,
									"parameters": {
										"variable": "SERVER_loggedIn",
										"value": "false"
									}
								},
								{
									"id": "set-boolean-eventvar",
									"objectClass": "System",
									"sid": 957596164899883,
									"parameters": {
										"variable": "SERVER_isAdmin",
										"value": "false"
									}
								}
							],
							"sid": 207165158508499,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 674585695822848,
											"parameters": {
												"first-value": "LayoutName",
												"comparison": 0,
												"second-value": "\"Creator\""
											}
										},
										{
											"id": "compare-eventvar",
											"objectClass": "System",
											"sid": 133604933458329,
											"parameters": {
												"variable": "MENU_menu",
												"comparison": 0,
												"value": "\"Card\""
											}
										}
									],
									"actions": [
										{
											"callFunction": "switchCardButtons",
											"sid": 792850298932970,
											"parameters": [
												false
											]
										}
									],
									"sid": 765964507436766
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "signal",
									"objectClass": "System",
									"sid": 668659375413448,
									"parameters": {
										"tag": "\"updateLoginButton\""
									}
								}
							],
							"sid": 975483828705115
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Set our uploaded character, if it exists"
				},
				{
					"eventType": "comment",
					"text": "TODO: make setting/flushing this like, a function or something"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-signal",
							"objectClass": "System",
							"sid": 787673885494085,
							"parameters": {
								"tag": "\"storeUploadedCharacter\""
							}
						}
					],
					"actions": [
						{
							"id": "set-boolean-eventvar",
							"objectClass": "System",
							"sid": 432188364236176,
							"parameters": {
								"variable": "SERVER_hasUploadedCharacter",
								"value": "true"
							}
						},
						{
							"id": "insert",
							"objectClass": "LocalCharacters",
							"sid": 998983533222249,
							"parameters": {
								"value": "SERVER_uploadedCharacterData",
								"index": "0",
								"axis": "x"
							}
						},
						{
							"id": "add-to-eventvar",
							"objectClass": "System",
							"sid": 287346463881716,
							"parameters": {
								"variable": "CREATOR_editIndex",
								"value": "1"
							}
						}
					],
					"sid": 782370168454950,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 854735356696310,
									"parameters": {
										"first-value": "LayoutName",
										"comparison": 0,
										"second-value": "\"Plaza\""
									}
								},
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 466952469855948,
									"parameters": {
										"variable": "PLAZA_state",
										"comparison": 0,
										"value": "\"local\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "updateCharacterList",
									"sid": 436548832065511,
									"parameters": [
										"PLAZA_state"
									]
								}
							],
							"sid": 199904827368270
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-start-of-layout",
							"objectClass": "System",
							"sid": 442406528954563
						},
						{
							"id": "on-signal",
							"objectClass": "System",
							"sid": 472459611539007,
							"parameters": {
								"tag": "\"updateLoginButton\""
							}
						}
					],
					"actions": [],
					"sid": 268497154621837,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "Button",
									"sid": 494800105286810,
									"parameters": {
										"instance-variable": "type",
										"comparison": 0,
										"value": "\"login\""
									}
								},
								{
									"id": "pick-children",
									"objectClass": "Button",
									"sid": 954091839167605,
									"parameters": {
										"child": "Text",
										"which": "own"
									}
								}
							],
							"actions": [],
							"sid": 809129929482868,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 347407863445046,
											"parameters": {
												"variable": "SERVER_loggedIn"
											}
										}
									],
									"actions": [
										{
											"id": "set-text",
											"objectClass": "Text",
											"sid": 578020417033242,
											"parameters": {
												"text": "\"Log out\""
											}
										}
									],
									"sid": 435998997765441,
									"children": [
										{
											"eventType": "comment",
											"text": "No need to log out on Newgrounds"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-boolean-eventvar",
													"objectClass": "System",
													"sid": 493221091645104,
													"parameters": {
														"variable": "NGIO_onNewgrounds"
													}
												}
											],
											"actions": [
												{
													"id": "set-boolean-instvar",
													"objectClass": "Button",
													"sid": 884087362172089,
													"parameters": {
														"instance-variable": "disabled",
														"value": "true"
													}
												}
											],
											"sid": 745272906153684
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 432397901955494
										}
									],
									"actions": [
										{
											"id": "set-text",
											"objectClass": "Text",
											"sid": 580647419515480,
											"parameters": {
												"text": "\"Log in\""
											}
										}
									],
									"sid": 957775539610603
								}
							]
						}
					],
					"isOrBlock": true
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Server - Login (Buttons)",
					"description": "",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "comment",
							"text": "Login"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 669640061167880,
									"parameters": {
										"tag": "\"button_login\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 336014980063264,
									"parameters": {
										"audio-file": "select",
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								}
							],
							"sid": 306826623881897,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-boolean-eventvar",
											"objectClass": "System",
											"sid": 200409917968424,
											"parameters": {
												"variable": "NGIO_onNewgrounds"
											},
											"isInverted": true
										}
									],
									"actions": [],
									"sid": 635172860999341,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "compare-boolean-eventvar",
													"objectClass": "System",
													"sid": 513446268483250,
													"parameters": {
														"variable": "SERVER_loggedIn"
													},
													"isInverted": true
												}
											],
											"actions": [],
											"sid": 919471860948733,
											"children": [
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 446219092816470,
															"parameters": {
																"variable": "MENU_overlayMenu",
																"comparison": 1,
																"value": "\"Login\""
															}
														}
													],
													"actions": [
														{
															"callFunction": "switchOverlayMenu",
															"sid": 584904460718641,
															"parameters": [
																"\"Login\""
															]
														}
													],
													"sid": 832817980834739
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "else",
															"objectClass": "System",
															"sid": 507597546220434
														}
													],
													"actions": [
														{
															"callFunction": "switchOverlayMenu",
															"sid": 143857433018218,
															"parameters": [
																"\"\""
															]
														}
													],
													"sid": 124267350072250
												}
											]
										},
										{
											"eventType": "comment",
											"text": "Logout, flush uploaded character"
										},
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "else",
													"objectClass": "System",
													"sid": 226607011749184
												}
											],
											"actions": [
												{
													"type": "script",
													"language": "typescript",
													"script": [
														"logout();"
													]
												},
												{
													"id": "set-boolean-eventvar",
													"objectClass": "System",
													"sid": 624031489290718,
													"parameters": {
														"variable": "SERVER_hasUploadedCharacter",
														"value": "false"
													}
												},
												{
													"id": "set-eventvar-value",
													"objectClass": "System",
													"sid": 646310999760467,
													"parameters": {
														"variable": "SERVER_uploadedCharacterData",
														"value": "\"\""
													}
												},
												{
													"id": "subtract-from-eventvar",
													"objectClass": "System",
													"sid": 366961302552657,
													"parameters": {
														"variable": "CREATOR_editIndex",
														"value": "1"
													}
												},
												{
													"id": "load",
													"objectClass": "LocalCharacters",
													"sid": 799946936788417,
													"parameters": {
														"json": "SavedCharacters.AsJSON"
													}
												}
											],
											"sid": 228952056500873,
											"children": [
												{
													"eventType": "comment",
													"text": "Logout of Newgrounds"
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "is-logged-in",
															"objectClass": "NGIO",
															"sid": 151275174935589
														}
													],
													"actions": [
														{
															"id": "logout",
															"objectClass": "NGIO",
															"sid": 401730996359702
														},
														{
															"id": "set-eventvar-value",
															"objectClass": "System",
															"sid": 422802944195644,
															"parameters": {
																"variable": "NGIO_sessionID",
																"value": "\"\""
															}
														}
													],
													"sid": 812699842167364
												},
												{
													"eventType": "block",
													"conditions": [
														{
															"id": "compare-two-values",
															"objectClass": "System",
															"sid": 256733484272373,
															"parameters": {
																"first-value": "LayoutName",
																"comparison": 0,
																"second-value": "\"Plaza\""
															}
														},
														{
															"id": "compare-eventvar",
															"objectClass": "System",
															"sid": 160116384067576,
															"parameters": {
																"variable": "PLAZA_state",
																"comparison": 0,
																"value": "\"local\""
															}
														}
													],
													"actions": [
														{
															"callFunction": "updateCharacterList",
															"sid": 543399446956009,
															"parameters": [
																"PLAZA_state"
															]
														}
													],
													"sid": 874568551444640
												}
											]
										}
									]
								},
								{
									"eventType": "comment",
									"text": "Skip straight to a NG login"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 359272605953236
										}
									],
									"actions": [
										{
											"id": "login",
											"objectClass": "NGIO",
											"sid": 601440249576485,
											"parameters": {
												"window-mode": "popup"
											}
										}
									],
									"sid": 555726136961088
								}
							]
						},
						{
							"eventType": "comment",
							"text": "Login Google"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 332409300021249,
									"parameters": {
										"tag": "\"button_loginGoogle\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 636635527688334,
									"parameters": {
										"audio-file": "select",
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"loginWithGoogle();"
									]
								}
							],
							"sid": 451050660063865
						},
						{
							"eventType": "comment",
							"text": "Login Itch"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 184771585005132,
									"parameters": {
										"tag": "\"button_loginItch\""
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 139609875815621,
									"parameters": {
										"audio-file": "select",
										"loop": "not-looping",
										"volume": "(log10(SETTING_volumeSound)*20)",
										"stereo-pan": "0",
										"tag-optional": "\"\""
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"loginWithItch();"
									]
								}
							],
							"sid": 128902473359258
						},
						{
							"eventType": "comment",
							"text": "Login Newgrounds"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-signal",
									"objectClass": "System",
									"sid": 271924202656439,
									"parameters": {
										"tag": "\"button_loginNewgrounds\""
									}
								}
							],
							"actions": [],
							"sid": 895498652903983,
							"children": [
								{
									"eventType": "comment",
									"text": "TODO: Triggers twice"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-ready",
											"objectClass": "NGIO",
											"sid": 435265702355208
										}
									],
									"actions": [
										{
											"id": "play",
											"objectClass": "Audio",
											"sid": 242747818779535,
											"parameters": {
												"audio-file": "select",
												"loop": "not-looping",
												"volume": "(log10(SETTING_volumeSound)*20)",
												"stereo-pan": "0",
												"tag-optional": "\"\""
											}
										},
										{
											"id": "login",
											"objectClass": "NGIO",
											"sid": 332317991084266,
											"parameters": {
												"window-mode": "popup"
											}
										}
									],
									"sid": 106978140348144
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 863165825861540
										}
									],
									"actions": [
										{
											"callFunction": "error",
											"sid": 364002082733517,
											"parameters": [
												"\"NGIO has not yet initialized. Is it down?\""
											]
										}
									],
									"sid": 569750784770595
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-login-success",
									"objectClass": "NGIO",
									"sid": 750001847314600
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 683671985035179,
									"parameters": {
										"variable": "NGIO_sessionID",
										"value": "NGIO.SessionID"
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"const session_id = runtime.globalVars.NGIO_sessionID as string;",
										"authenticateNewgrounds(session_id);"
									]
								}
							],
							"sid": 774989036771965
						}
					],
					"sid": 498964445715037
				}
			],
			"sid": 807351581983461
		}
	],
	"sid": 604583817691514
}